# npm2rez 开发任务清单

## 依赖解析与自动创建功能

### 背景
当安装一个 npm 包时，该包通常依赖于其他第三方包。目前 npm2rez 只创建指定的包，没有处理依赖关系。我们需要实现自动解析依赖并创建对应的 rez 包的功能。

### 任务列表

- [ ] **依赖解析功能**
  - [ ] 解析 npm 包的 `package.json` 文件，提取 `dependencies` 字段
  - [ ] 区分开发依赖 (`devDependencies`) 和运行时依赖 (`dependencies`)
  - [ ] 支持解析特定版本范围 (例如 `^1.0.0`, `~2.3.4`, `>=3.0.0`)

- [ ] **rez 包检测功能**
  - [ ] 开发检测已安装 rez 包的函数
  - [ ] 根据包名和版本范围判断是否需要创建新的 rez 包
  - [ ] 处理版本冲突情况的策略

- [ ] **递归依赖处理**
  - [ ] 实现递归解析依赖树的功能
  - [ ] 避免循环依赖问题
  - [ ] 优化依赖安装顺序，确保基础包先安装

- [ ] **命令行参数扩展**
  - [ ] 添加 `--resolve-deps` 参数，控制是否自动解析并安装依赖
  - [ ] 添加 `--deps-depth` 参数，控制依赖解析的深度
  - [ ] 添加 `--skip-existing` 参数，控制是否跳过已存在的 rez 包

- [ ] **依赖关系维护**
  - [ ] 在生成的 `package.py` 中正确设置 `requires` 字段，引用已创建的依赖包
  - [ ] 处理版本兼容性问题，确保 rez 解析器能正确处理依赖关系

- [ ] **测试用例**
  - [ ] 为依赖解析功能编写单元测试
  - [ ] 为复杂依赖树场景编写集成测试
  - [ ] 测试版本冲突解决策略

- [ ] **文档更新**
  - [ ] 更新 README.md，说明新增的依赖解析功能
  - [ ] 添加使用示例和最佳实践
  - [ ] 更新命令行参数文档

### 实现思路

1. 使用 `npm list --json` 命令获取完整的依赖树信息
2. 解析 JSON 输出，构建依赖关系图
3. 按照拓扑排序顺序处理依赖，确保基础包先安装
4. 对于每个依赖，检查对应的 rez 包是否存在
5. 如果不存在，使用现有的 npm2rez 功能创建新的 rez 包
6. 在生成的 `package.py` 中设置正确的 `requires` 字段

### 注意事项

- 需要处理 npm 和 rez 版本规范的差异
- 考虑性能问题，避免重复解析和安装
- 提供跳过某些依赖的机制，处理不兼容或不需要的包
- 考虑如何处理原生模块（需要编译的模块）的依赖
